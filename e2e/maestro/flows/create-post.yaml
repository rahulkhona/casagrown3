# Create Post Flow — Maestro E2E test
# Tests navigating to the create post form and verifying form fields.

appId: dev.casagrown.community

---

# Login first
- runFlow: ../utils/login.yaml

# Wait for feed to load
- extendedWaitUntil:
          visible: "Create Post"
          timeout: 15000

# Tap create post button
- tapOn: "Create Post"

# Should show post type selection
- extendedWaitUntil:
          visible: "What would you like to share with your community?"
          timeout: 10000

# Select "Looking to Sell" (a11y label includes full description)
- tapOn:
          text: ".*Looking to Sell.*"

# Should show the sell form — title is "Sell Produce"
- extendedWaitUntil:
          visible: "Sell Produce"
          timeout: 10000

# Verify form fields (labels include * for required)
- assertVisible:
          text: ".*Category.*"
- assertVisible:
          text: ".*Product.*"

# Go back to type selection
- tapOn: "Back"

# Verify we're back on type selection
- extendedWaitUntil:
          visible: "What would you like to share with your community?"
          timeout: 5000

# ──────────────────────────────────────────────
# Now test the Buy form fields
# ──────────────────────────────────────────────
- tapOn:
          text: ".*Looking to Buy.*"

# Should show the buy form
- extendedWaitUntil:
          visible:
                  text: ".*Looking to Buy.*"
          timeout: 10000

# Verify buy form fields
- assertVisible:
          text: ".*What are you looking for.*"
- assertVisible:
          text: ".*Desired Quantity.*"
- assertVisible:
          text: ".*Unit.*"

# Scroll to see date fields (below the fold on mobile)
- scrollUntilVisible:
          element:
                  text: ".*Latest Drop-off Date.*"
          direction: DOWN
          timeout: 10000

- scrollUntilVisible:
          element:
                  text: ".*Accept Drop-off Dates.*"
          direction: DOWN
          timeout: 10000

- scrollUntilVisible:
          element:
                  text: ".*Add a date.*"
          direction: DOWN
          timeout: 10000

# Go back to type selection
- tapOn: "Back"

# Go back to feed
- tapOn: "Back"

# Verify we're back on feed (longer timeout — community resolution
# may still be in progress after a fresh login)
- extendedWaitUntil:
          visible: "Tomatoes"
          timeout: 30000
