#!/bin/sh

# Pre-commit hook: Run unit tests before committing
# Ensures service logic is not broken across apps.

echo "ğŸ” Running pre-commit checks..."

# 1. Run Community Voice unit tests (vitest, ~300ms)
echo "ğŸ“‹ Running Community Voice unit tests..."
cd apps/next-community-voice && npx vitest run --reporter=dot 2>&1 || {
    echo "âŒ Community Voice unit tests failed â€” commit aborted."
    exit 1
}
cd ../..

# 2. Run Community App unit tests (jest, ~10s)
echo "ğŸ“‹ Running Community App unit tests..."
yarn workspace @casagrown/app jest --passWithNoTests --bail 2>&1 || {
    echo "âŒ Community App unit tests failed â€” commit aborted."
    exit 1
}

echo "âœ… All pre-commit checks passed!"
